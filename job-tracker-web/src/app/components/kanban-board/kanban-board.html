<div class="kanban-board">
  <div class="board-container">
    <ng-container
      *ngTemplateOutlet="
        columnTemplate;
        context: {
          $implicit: appliedJobs(),
          title: 'Applied',
          status: statuses.APPLIED,
          statusClass: 'status-applied'
        }
      "
    ></ng-container>

    <ng-container
      *ngTemplateOutlet="
        columnTemplate;
        context: {
          $implicit: interviewingJobs(),
          title: 'Interviewing',
          status: statuses.INTERVIEWING,
          statusClass: 'status-interviewing'
        }
      "
    ></ng-container>

    <ng-container
      *ngTemplateOutlet="
        columnTemplate;
        context: {
          $implicit: offerJobs(),
          title: 'Offer',
          status: statuses.OFFER,
          statusClass: 'status-offer'
        }
      "
    ></ng-container>

    <ng-container
      *ngTemplateOutlet="
        columnTemplate;
        context: {
          $implicit: rejectedJobs(),
          title: 'Rejected',
          status: statuses.REJECTED,
          statusClass: 'status-rejected'
        }
      "
    ></ng-container>
  </div>
</div>

<ng-template
  #columnTemplate
  let-jobs
  let-title="title"
  let-status="status"
  let-statusClass="statusClass"
>
  <div class="column" [class]="statusClass">
    <h2>{{ title }} ({{ jobs.length }})</h2>

    <div
      cdkDropList
      [cdkDropListData]="jobs"
      class="job-list"
      [id]="getStatusListId(status)"
      [cdkDropListConnectedTo]="columnIds"
      (cdkDropListDropped)="drop($event)"
    >
      @for (job of jobs; track job.id) {
      <mat-card cdkDrag (click)="editJob(job)" class="clickable-card">
        <mat-card-header>
          <mat-card-title>{{ job.jobTitle }}</mat-card-title>
          <mat-card-subtitle>{{ job.companyName }}</mat-card-subtitle>
          <button
            mat-icon-button
            color="warn"
            class="delete-btn"
            (click)="$event.stopPropagation(); deleteJob(job.id!)"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <p>Applied: {{ job.dateApplied | date : 'mediumDate' }}</p>
        </mat-card-content>

        <mat-card-actions align="end">
          <button mat-stroked-button color="primary" (click)="openAnalysis(job.id)">
            <mat-icon>psychology</mat-icon> Analyze
          </button>
        </mat-card-actions>
      </mat-card>
      } @if (jobs.length === 0) {
      <div class="placeholder">Drop applications here</div>
      }
    </div>
  </div>
</ng-template>
