<h2 mat-dialog-title>
  AI Analysis: {{ data.jobTitle }}
</h2>

<mat-dialog-content class="dialog-content">

  @if (!isLoading() && !analysisData() && !errorMessage()) {
  <div class="upload-section">
    <div class="icon-circle">
      <mat-icon class="upload-icon">cloud_upload</mat-icon>
    </div>
    <h3>Upload Resume</h3>
    <p>Select your PDF resume to start the AI analysis.</p>

    <input type="file" #fileInput (change)="onFileSelected($event)" accept=".pdf" style="display: none;">

    <button mat-flat-button color="primary" (click)="fileInput.click()">
      Choose PDF File
    </button>
  </div>
  }

  @if (isLoading()) {
  <div class="loading-container">
    <div class="loading-text">
      <mat-icon class="spin">sync</mat-icon>
      <p>Consulting Gemini AI...</p>
    </div>
    <p class="sub-text">Reading your resume and analyzing match score...</p>

    <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
  </div>
  }

  @if (errorMessage()) {
  <div class="error-container">
    <mat-icon color="warn">error_outline</mat-icon>
    <p>{{ errorMessage() }}</p>
    <button mat-button color="primary" (click)="errorMessage.set(null)">Try Again</button>
  </div>
  }

  @if (analysisData(); as result) {
  <div class="result-container">

    <div class="score-section">
      <div class="score-circle" [ngClass]="getScoreColor(result.matchScore)">
        <span class="score-value">{{ result.matchScore }}</span>
        <span class="score-label">Match</span>
      </div>
    </div>

    <div class="section">
      <h3><mat-icon>thumb_up</mat-icon> Strengths</h3>
      <p>{{ result.strengths }}</p>
    </div>

    <div class="section">
      <h3><mat-icon>vpn_key</mat-icon> Missing Keywords</h3>
      <p class="hint">Consider adding these to your resume:</p>
      <mat-chip-set>
        @for (keyword of result.keywordsToIntegrate; track keyword) {
        <mat-chip>{{ keyword }}</mat-chip>
        }
      </mat-chip-set>
    </div>

  </div>
  }

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Close</button>
</mat-dialog-actions>